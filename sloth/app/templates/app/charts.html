<script src='https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js'></script>
<script src='/static/js/echarts-wordcloud.js'></script>
<script>
	let x = [];
	let y = [];
	let originalData = {{ data|safe }}
	let data = [];
	let color = [];
	{% for x, serie in data.series.items %}
		x.push('{{ x }}');
		{% for y, value, color in serie %}
			{% if forloop.parentloop.first %}
				y.push('{{ y }}');
				data[{{ forloop.counter0 }}] = [];
				color.push('{{ color }}');
			{% endif %}
			data[{{ forloop.counter0 }}].push({{ value }})
		{% endfor %}
	{% endfor %}
</script>
<style>
	div{display: inline-block;}
</style>

<div id="main1" style="width: 600px;height:400px;"></div>
<div id="main2" style="width: 600px;height:400px;"></div>
<div id="main3" style="width: 600px;height:400px;"></div>
<div id="main4" style="width: 600px;height:400px;"></div>
<div id="main5" style="width: 600px;height:400px;"></div>
<div id="main6" style="width: 600px;height:400px;"></div>
<div id="main7" style="width: 600px;height:400px;"></div>
<div id="main8" style="width: 600px;height:400px;"></div>
<div id="main9" style="width: 600px;height:400px;"></div>
<div id="main10" style="width: 600px;height:400px;"></div>
<div id="main11" style="width: 600px;height:400px;"></div>
<div id="main12" style="width: 600px;height:400px;"></div>
<div id="main13" style="width: 600px;height:400px;"></div>
<div id="main14" style="width: 600px;height:400px;"></div>

<script>
    const LINE_CHART = 'line';
    const STACKED_LINE_CHART = 'stacked_line';
    const AREA_CHART = 'area';
    const STACKED_ARE_CHART = 'stacked_area';
    const VERTICAL_BAR_CHART = 'vertical_bar';
    const STACKED_VERTICAL_BAR_CHART = 'stacked_vertical_bar';
    const HORIZONTAL_BAR_CHART = 'horizontal_bar';
    const STACKED_HORIZONTAL_BAR_CHART = 'stacked_horizontal_bar';
    const PIE_CHART = 'pie';
    const DONUT_CHART = 'donut';
    const RADIAL_CHART = 'radial';

    function getParameters(type) {
        let chartType = '';
        let area = false;
        let horizontal = false;
        let stacked = false;
        switch (type) {
            case LINE_CHART:
                chartType = 'line';
                break
            case STACKED_LINE_CHART:
                chartType = 'line';
                stacked = true;
                break
            case AREA_CHART:
                chartType = 'line';
                area = true;
                break
            case STACKED_ARE_CHART:
                chartType = 'line';
                area = true;
                stacked = true;
                break
            case RADIAL_CHART:
            case VERTICAL_BAR_CHART:
                chartType = 'bar';
                break
            case STACKED_VERTICAL_BAR_CHART:
                chartType = 'bar';
                stacked = true;
                break
            case HORIZONTAL_BAR_CHART:
                chartType = 'bar';
                horizontal = true;
                break
            case STACKED_HORIZONTAL_BAR_CHART:
                chartType = 'bar';
                horizontal = true;
                stacked = true;
                break
            case PIE_CHART:
            case DONUT_CHART:
                chartType = 'pie';
                break;
        }
        return [chartType, area, horizontal, stacked];
    }

    function getOption(title='', type=LINE_CHART) {
        let series = [];
        let [chartType, area, horizontal, stacked] = getParameters(type);
        if ([PIE_CHART, DONUT_CHART, RADIAL_CHART].includes(type)) {
            let values = [];
            for (let i = 0; i < y.length; i++) {
                let total = 0;
                for (let j = 0; j < x.length; j++) {
                    total += data[i][j];
                }
                values.push({value: total, name: y[i]});
            }
            let serie = {
                type: chartType,
                data: values,
            }
            if (type == PIE_CHART) {
                serie['radius'] = '50%';
            } else if (type == DONUT_CHART) {
                serie['radius'] = ['40%', '70%'];
            } else if (type == RADIAL_CHART) {
                serie['coordinateSystem'] = 'polar';
            }
            series.push(serie);
        } else {
            for (let i = 0; i < y.length; i++) {
                let serie = {
                    name: y[i],
                    type: chartType,
                    label: {show: true},
                    emphasis: {focus: 'series'},
                    data: data[i],
                }
                if (stacked) {
                    serie['stack'] = 'total';
                }
                if (area) {
                    serie['areaStyle'] = {};
                }
                series.push(serie);
            }
        }
        let option = {
            title: {text: title},
            tooltip: {trigger: 'axis'},
            legend: {data: y},
            toolbox: {feature: {saveAsImage: { title: 'Salvar como Imagem' }}},
            series: series,
            color: color,
        }
        if ([PIE_CHART, DONUT_CHART].includes(type)) {
            option['title'] = {text: title, subtext: '', left: 'center'};
            option['tooltip'] = {trigger: 'item'};
            option['legend'] = {orient: 'vertical', left: 'left'};
        } else if (type == RADIAL_CHART) {
            option = {
                title: {text: title},
                tooltip: {trigger: 'axis'},
                polar: {radius: [30, '80%']},
                radiusAxis: { },
                angleAxis: {type: 'category', data: y, startAngle: 75},
                toolbox: {feature: {saveAsImage: { title: 'Salvar como Imagem' }}},
                series: series,
                color: color,
            };
        } else {
            option['xAxis'] = {type: 'category', data: x};
            option['yAxis']= {type: 'value'};
            if (horizontal) {
                option['xAxis'] = {type: 'value'}
                option['yAxis']= {type: 'category', data: x}
                option['grid'] = {left: '3%', right: '4%', bottom: '3%', containLabel: true}
            }
        }
        return option;
    }
    let option;

    option = getOption('Line', originalData.chart);
    echarts.init(document.getElementById('main1')).setOption(option);

    // option = getOption('Line', LINE_CHART);
    // echarts.init(document.getElementById('main1')).setOption(option);
    //
    // option = getOption('Stacked Line', STACKED_LINE_CHART);
    // echarts.init(document.getElementById('main2')).setOption(option);
    //
    // option = getOption('Area', AREA_CHART);
    // echarts.init(document.getElementById('main3')).setOption(option);
    //
    // option = getOption('Stacked Area', STACKED_ARE_CHART);
    // echarts.init(document.getElementById('main4')).setOption(option);
    //
    // option = getOption('Vertical Bars', VERTICAL_BAR_CHART);
    // echarts.init(document.getElementById('main5')).setOption(option);
    //
    // option = getOption('Stacked Vertical Bars', STACKED_VERTICAL_BAR_CHART);
    // echarts.init(document.getElementById('main6')).setOption(option);
    //
    // option = getOption('Horizontal Bars', HORIZONTAL_BAR_CHART);
    // echarts.init(document.getElementById('main7')).setOption(option);
    //
    // option = getOption('Stacked Horizontal Bar', STACKED_HORIZONTAL_BAR_CHART);
    // echarts.init(document.getElementById('main8')).setOption(option);
    //
    // option = getOption('Pie', PIE_CHART);
    // echarts.init(document.getElementById('main9')).setOption(option);
    //
    // option = getOption('Donut', DONUT_CHART);
    // echarts.init(document.getElementById('main10')).setOption(option);
    //
    // option = getOption('Radial Bar', RADIAL_CHART);
    // echarts.init(document.getElementById('main11')).setOption(option);

	// // Calendar
	// const graphData = [['2023-02-01', 260], ['2023-02-04', 200], ['2023-02-09', 279], ['2023-02-13', 847], ['2023-02-18', 241], ['2023-02-23', 411], ['2023-02-27', 985]];
	// const links = graphData.map(function (item, idx) {
	// 	return {
	// 		source: idx,
	// 		target: idx + 1
	// 	};
	// });
	// links.pop();
	// option = {
	// 	tooltip: {
	// 		position: 'top'
	// 	},
	// 	visualMap: [
	// 		{
	// 			min: 0,
	// 			max: 1000,
	// 			calculable: true,
	// 			seriesIndex: [0],
	// 			orient: 'horizontal',
	// 			left: 0,
	// 			top: 300
	// 		}
	// 	],
	// 	calendar: [
	// 		{
	// 			orient: 'vertical',
	// 			yearLabel: {
	// 				margin: 40
	// 			},
	// 			monthLabel: {
	// 				margin: 20
	// 			},
	// 			dayLabel: {
	// 				firstDay: 1,
	// 			},
	// 			cellSize: 40,
	// 			top: 70,
	// 			range: '2023-02'
	// 		}
	// 	],
	// 	series: [
	// 		{
	// 			type: 'effectScatter',
	// 			coordinateSystem: 'calendar',
	// 			calendarIndex: 0,
	// 			symbolSize: function (val) {
	// 				return val[1] / 40;
	// 			},
	// 			data: graphData,
	// 			label: {
	// 				show: true,
	// 				formatter: function (params) {
	// 					let d = echarts.number.parseDate(params.value[0]);
	// 					return d.getDate();
	// 				},
	// 				color: '#DDD'
	// 			}
	// 		}
	// 	], color: color
	// };
	// echarts.init(document.getElementById('main12')).setOption(option);
    //
	// // Words
	// let chart = echarts.init(document.getElementById('main13'));
	// option = {
	// 	tooltip: {},
	// 	title : {
	// 		text: 'Red - Already Over - Lyrics',
	// 	},
	// 	toolbox: {
	// 		feature: {
	// 			saveAsImage: {}
	// 		}
	// 	},
	// 	series: [
	// 		{
	// 			type: 'wordCloud',
	// 			gridSize: 3,
	// 			sizeRange: [15, 55],
	// 			rotationRange: [-45, 45],
	// 			shape: 'pentagon',
	// 			width: 600,
	// 			height: 400,
	// 			textStyle: {
	// 				normal: {
	// 					color: function () {
	// 						return 'rgb(' + [
	// 							Math.round(Math.random() * 160),
	// 							Math.round(Math.random() * 160),
	// 							Math.round(Math.random() * 160)
	// 						].join(',') + ')';
	// 					}
	// 				},
	// 				emphasis: {
	// 					shadowBlur: 10,
	// 					shadowColor: '#333'
	// 				}
	// 			},
	// 			data: [
	// 				{
	// 					name: 'Already Over',
	// 					value: 10000,
	// 					textStyle: {
	// 						normal: {
	// 							color: 'black'
	// 						},
	// 						emphasis: {
	// 							color: 'blue'
	// 						}
	// 					}
	// 				},
	// 				{
	// 					name: 'now',
	// 					value: 4055
	// 				},
	// 				{
	// 					name: 'know',
	// 					value: 2467
	// 				},
	// 				{
	// 					name: 'reaching',
	// 					value: 2244
	// 				},
	// 				{
	// 					name: 'nothing',
	// 					value: 1898
	// 				},
	// 				{
	// 					name: 'letting',
	// 					value: 1484
	// 				},
	// 				{
	// 					name: 'fall',
	// 					value: 1112
	// 				},
	// 				{
	// 					name: 'give',
	// 					value: 965
	// 				},
	// 				{
	// 					name: 'loving',
	// 					value: 847
	// 				},
	// 				{
	// 					name: 'go',
	// 					value: 582
	// 				},
	// 				{
	// 					name: 'left',
	// 					value: 555
	// 				},
	// 				{
	// 					name: 'lose',
	// 					value: 550
	// 				},
	// 				{
	// 					name: 'everything',
	// 					value: 462
	// 				},
	// 				{
	// 					name: 'never',
	// 					value: 366
	// 				},
	// 				{
	// 					name: 'breaking',
	// 					value: 360
	// 				},
	// 				{
	// 					name: 'slowly',
	// 					value: 282
	// 				},
	// 				{
	// 					name: 'all',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'here',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'skin',
	// 					value: 9973
	// 				},
	// 				{
	// 					name: 'you',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'resist',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'again',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'suffocating',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'defense',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'cost',
	// 					value: 273
	// 				},
	// 				{
	// 					name: 'fading',
	// 					value: 265
	// 				}
	// 			]
	// 		}
	// 	], color: color
	// };
	// chart.setOption(option);
</script>

